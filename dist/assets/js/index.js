"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],a=!0,o=!1,s=void 0;try{for(var i,r=e[Symbol.iterator]();!(a=(i=r.next()).done)&&(n.push(i.value),!t||n.length!==t);a=!0);}catch(e){o=!0,s=e}finally{try{!a&&r.return&&r.return()}finally{if(o)throw s}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var getHtmlElement=function(e){return document.querySelector(e)},addClass=function(e,t){e.classList.add(t)},removeClass=function(e,t){e.classList.remove(t)},renderBox=getHtmlElement(".markdown-body"),textarea=getHtmlElement("textarea"),mainSection=getHtmlElement("section.main"),historySection=getHtmlElement("section.history"),settingsSection=getHtmlElement("section.settings"),rawText=localStorage.getItem("rawText"),activeModals=[],saveHistory=void 0,cursorLastPosition=void 0,returnKeyToggle=void 0,sectionMainEventListener=void 0,converter=void 0,toggleDisplay=function(e){e?(removeClass(textarea,"nodisplay"),addClass(renderBox,"nodisplay")):(addClass(textarea,"nodisplay"),removeClass(renderBox,"nodisplay"))},localToChromeStorage=function(){localStorage.getItem("rawText")&&chrome.storage.sync.set({})},moveCaretToStart=function(){if("number"==typeof textarea.selectionStart)textarea.selectionStart=textarea.selectionEnd=0;else if(void 0!==textarea.createTextRange){textarea.focus();var e=textarea.createTextRange();e.collapse(!0),e.select()}},edit=function(){toggleDisplay(1),textarea.focus(),cursorLastPosition?textarea.selectionStart=Number(localStorage.getItem("cursorLastPosition")):(moveCaretToStart(),textarea.scrollTop=0),removeClass(getHtmlElement("#save"),"nodisplay"),addClass(getHtmlElement("#edit"),"nodisplay")},save=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;localStorage.setItem("cursorLastPosition",textarea.selectionStart),toggleDisplay(0);var t=textarea.value,n=converter.makeHtml(t);renderBox.innerHTML=n,n!==converter.makeHtml(rawText)&&(localStorage.setItem("rawText",t),rawText=t,saveHistory&&e&&(localStorage.setItem("lastEdited",new Date),setHistory())),removeClass(getHtmlElement("#edit"),"nodisplay"),addClass(getHtmlElement("#save"),"nodisplay")},getHistory=function(){var e=localStorage.getItem("history");return null===e?[]:JSON.parse(e)},setHistory=function(){var e=getHistory(),t={date:new Date,text:rawText};e.unshift(t),localStorage.setItem("history",JSON.stringify(e))},displayMarkdown=function(e){var t=decodeURIComponent(escape(atob(e.getAttribute("data-text")))),n=e.children[1],a=e.children[2];n.innerHTML=converter.makeHtml(t),removeClass(n,"nodisplay"),addClass(a,"nodisplay")},displayTextarea=function(e){var t=decodeURIComponent(escape(atob(e.getAttribute("data-text")))),n=e.children[1],a=e.children[2];addClass(n,"nodisplay"),removeClass(a,"nodisplay"),a.innerHTML=t},populateHistoryHtml=function e(){var t="",n=getHistory(),a=n.length;n.map(function(e,n){var o=new Date(Date.parse(e.date)),s=o.toDateString().slice(4)+", "+o.toTimeString().slice(0,8),i=btoa(unescape(encodeURIComponent(e.text)));t+="<div class='item' data-text='"+i+"'>\n                <div class='label flex'>\n                    <div>\n                        <p class='id'>#"+(a-n)+"</p>\n                        <p class='date'>"+s+"</p>\n                    </div>\n                    <div class='noselect flex'>\n                        <div class='button'>\n                            <img class='nodrag' src='/assets/svg/bin.svg'/>\n                        </div>\n                        <div class='button'>\n                            <img class='nodrag' src='/assets/svg/view.svg'/>\n                        </div>\n                    </div>\n                </div>\n                <div class='markdown-body'></div>\n                <textarea class='nodisplay' readonly></textarea>\n            </div>"}),getHtmlElement("section.history .list").innerHTML=t,[].concat(_toConsumableArray(document.querySelectorAll("section.history .item"))).reverse().map(function(t,o){displayMarkdown(t);var s=_slicedToArray(t.children[0].children[1].children,2),i=s[0],r=s[1];i.addEventListener("click",function(){n.splice(a-o-1,1),localStorage.setItem("history",JSON.stringify(n)),e()}),r.addEventListener("click",function(){t.children[2].classList.contains("nodisplay")?displayTextarea(t):displayMarkdown(t)})})},getSettings=function(){var e=localStorage.getItem("settings");return null===e?null:JSON.parse(e)},setSettings=function(e,t){var n=getSettings();null===n||6!==Object.keys(n).length?n={saveHistory:!0,cursorLastPosition:!0,returnKeyToggle:!1,enablePowerMode:!1,PowerModeColor:!1,PowerModeShake:!1}:n[e]=t,localStorage.setItem("settings",JSON.stringify(n))},settingsControl=function e(){var t=getSettings(),n=document.querySelectorAll("section.settings .item");[].concat(_toConsumableArray(n)).map(function(n){var a=n.getAttribute("data-setting"),o=t[a];removeClass(n,o?"off":"on"),addClass(n,o?"on":"off"),n.onclick=function(){setSettings(a,!o),e()}}),applySettings()},applySettings=function(){var e=getSettings();saveHistory=e.saveHistory,cursorLastPosition=e.cursorLastPosition,returnKeyToggle=e.returnKeyToggle,e.enablePowerMode?textarea.addEventListener("input",POWERMODE,!1):textarea.removeEventListener("input",POWERMODE,!1),POWERMODE.colorful=e.PowerModeColor,POWERMODE.shake=e.PowerModeShake},openModal=function(e,t){t&&t(),-1===activeModals.indexOf(e)&&activeModals.push(e),1===activeModals.length?(removeClass(e,"z-index-3"),addClass(e,"z-index-2")):2===activeModals.length&&(removeClass(e,"z-index-2"),addClass(e,"z-index-3")),removeClass(e,"nodisplay"),removeClass(mainSection,"noblur"),addClass(mainSection,"blur"),sectionMainEventListener||(sectionMainEventListener=!0,mainSection.addEventListener("click",function(){return closeModal(activeModals)},!1))},closeModal=function e(t){t.constructor===Array?t.map(function(t){return e(t)}):(-1!==activeModals.indexOf(t)&&activeModals.splice(activeModals.indexOf(t),1),addClass(t,"nodisplay")),0===activeModals.length&&(removeClass(mainSection,"blur"),addClass(mainSection,"noblur"))},dragModal=function(e){var t=getHtmlElement("section."+e),n=0,a=0,o=0,s=0,i=function(e){(e=e||window.event).preventDefault(),n=o-e.clientX,a=s-e.clientY,o=e.clientX,s=e.clientY,t.style.top=t.offsetTop-a+"px",t.style.left=t.offsetLeft-n+"px"},r=function e(){document.removeEventListener("mouseup",e,!1),document.removeEventListener("mousemove",i,!1)};getHtmlElement("section."+e+" .header").addEventListener("mousedown",function(e){(e=e||window.event).preventDefault(),o=e.clientX,s=e.clientY,document.addEventListener("mouseup",r,!1),document.addEventListener("mousemove",i,!1)},!1)},timeDisplay=function(){var e=getHtmlElement("#time");setInterval(function(){var t=new Date,n=(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getFullYear()<10?"0"+t.getFullYear():t.getFullYear())+" - "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());e.innerHTML=n},1e3)},initiate=function(){setSettings(),settingsControl(),(converter=new showdown.Converter({simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,strikethrough:!0,tables:!0,tasklist:!0,ghCodeBlocks:!0,smoothLivePreview:!0,smartIndentationFix:!0,simpleLineBreaks:!0,openLinksInNewWindow:!0,emoji:!0})).setFlavor("github"),textarea.value=null===rawText?"# Hello, world!\n\nStart editing right now by clicking the *edit* button or pressing <kbd>"+(navigator.platform.match("Mac")?"Cmd":"Ctrl")+"</kbd> + <kbd>X</kbd>.\n\nTo save the file click the *save* button or press <kbd>"+(navigator.platform.match("Mac")?"Cmd":"Ctrl")+"</kbd> + <kbd>S</kbd>.\n\nCheers!":rawText,save(),dragModal("history"),dragModal("settings"),timeDisplay(),setInterval(function(){getHtmlElement("#lastEdited").innerHTML="Last edited: "+timeago().format(Date.parse(localStorage.getItem("lastEdited")))},1e3),getHtmlElement("#edit").addEventListener("click",function(){edit()},!1),getHtmlElement("#save").addEventListener("click",function(){save()},!1),getHtmlElement("#lastEdited").addEventListener("click",function(){openModal(historySection,populateHistoryHtml)},!1),getHtmlElement("#closeHistory").addEventListener("click",function(){closeModal(historySection)},!1),getHtmlElement("#settings").addEventListener("click",function(){openModal(settingsSection,settingsControl)},!1),getHtmlElement("#closeSettings").addEventListener("click",function(){closeModal(settingsSection)},!1),document.addEventListener("keydown",function(e){(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?returnKeyToggle?13===e.keyCode&&(renderBox.classList.contains("nodisplay")?(e.preventDefault(),save()):(e.preventDefault(),edit())):83===e.keyCode?(e.preventDefault(),renderBox.classList.contains("nodisplay")&&save()):88===e.keyCode&&(e.preventDefault(),textarea.classList.contains("nodisplay")&&edit()):27===e.keyCode&&activeModals.length>0&&closeModal([].concat(activeModals).pop())},!1),document.addEventListener("visibilitychange",function(){document.hidden&&renderBox.classList.contains("nodisplay")&&(save(0),edit(),textarea.selectionStart=Number(localStorage.getItem("cursorLastPosition")))})};initiate();