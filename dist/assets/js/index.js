"use strict";var _slicedToArray=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],o=!0,a=!1,i=void 0;try{for(var l,s=e[Symbol.iterator]();!(o=(l=s.next()).done)&&(n.push(l.value),!t||n.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{!o&&s.return&&s.return()}finally{if(a)throw i}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}var getHtmlElement=function(e){return document.querySelector(e)},addClass=function(e,t){e.classList.add(t)},removeClass=function(e,t){e.classList.remove(t)},renderBox=getHtmlElement(".markdown-body"),textarea=getHtmlElement("textarea"),mainSection=getHtmlElement("section.main"),dashboardSection=getHtmlElement("section.dashboard"),historySection=getHtmlElement("section.history"),settingsSection=getHtmlElement("section.settings"),notelistSection=getHtmlElement("section.notelist"),noteaddSection=getHtmlElement("section.notes-add"),noteeditSection=getHtmlElement("section.notes-edit"),rawText=localStorage.getItem("rawText"),activeModals=[],saveHistory=void 0,cursorLastPosition=void 0,sectionMainEventListener=void 0,converter=void 0,toggleDisplay=function(e){e?(removeClass(textarea,"nodisplay"),addClass(renderBox,"nodisplay")):(addClass(textarea,"nodisplay"),removeClass(renderBox,"nodisplay"))},moveCaretToStart=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;if("number"==typeof textarea.selectionStart)textarea.selectionStart=textarea.selectionEnd=0,-1!==e&&(textarea.selectionEnd=e),-1!==t&&(textarea.selectionStart=t);else if(void 0!==textarea.createTextRange){textarea.focus();var n=textarea.createTextRange();n.collapse(!0),-1!==e&&n.moveEnd("character",e),-1!==t&&n.moveStart("character",t),n.select()}},show=function(){toggleDisplay(0),moveCaretToStart(),textarea.focus(),textarea.scrollTop=0;var e=textarea.value,t=converter.makeHtml(e);renderBox.innerHTML=t,removeClass(getHtmlElement("#edit"),"nodisplay"),addClass(getHtmlElement("#save"),"nodisplay")},edit=function(){if(toggleDisplay(1),textarea.focus(),cursorLastPosition)if("default"===lastOpenedNote){var e=Number(localStorage.getItem("cursorLastPosition"));moveCaretToStart(Number(e),Number(e))}else{var t=getNote(lastOpenedNote);if(null!==t&&"cursorLastPosition"in t){var n=Number(t.cursorLastPosition);moveCaretToStart(Number(n),Number(n))}}else moveCaretToStart(),textarea.scrollTop=0;removeClass(getHtmlElement("#save"),"nodisplay"),addClass(getHtmlElement("#edit"),"nodisplay")},save=function(){toggleDisplay(0);var e=textarea.value,t=converter.makeHtml(e);if(renderBox.innerHTML=t,t!==converter.makeHtml(rawText))if("default"===lastOpenedNote)localStorage.setItem("rawText",e),localStorage.setItem("cursorLastPosition",textarea.selectionStart),rawText=e,saveHistory&&(localStorage.setItem("lastEdited",new Date),setHistory());else{var n=localStorage.getItem("notes");if(null!==n){var o=JSON.parse(n);if(lastOpenedNote in o){var a=o[lastOpenedNote];a.rawText=e,rawText=e,a.lastEdited=new Date,a.cursorLastPosition=textarea.selectionStart,a.history=[],saveHistory&&(a.history=updateNoteHistory(a)),o[lastOpenedNote]=a,localStorage.setItem("notes",JSON.stringify(o))}}}removeClass(getHtmlElement("#edit"),"nodisplay"),addClass(getHtmlElement("#save"),"nodisplay")},getNote=function(e){var t=localStorage.getItem("notes");if(null!==t){var n=JSON.parse(t);if(e in n)return n[e]}return null},setNoteHistory=function(e){var t=localStorage.getItem("notes");if(null!==t){var n=JSON.parse(t);if(lastOpenedNote in n)n[lastOpenedNote].history=e,localStorage.setItem("notes",JSON.stringify(n))}},updateNoteHistory=function(e){var t=e.history,n={date:new Date,text:rawText};return t.unshift(n),t},getNoteHistory=function(){if("default"===lastOpenedNote)return getHistory();var e=localStorage.getItem("notes");if(null!==e){var t=JSON.parse(e);if(lastOpenedNote in t)return t[lastOpenedNote].history}return[]},getHistory=function(){var e=localStorage.getItem("history");return null===e?[]:JSON.parse(e)},setHistory=function(){var e=getHistory(),t={date:new Date,text:rawText};e.unshift(t),localStorage.setItem("history",JSON.stringify(e))},displayMarkdown=function(e){var t=decodeURIComponent(escape(atob(e.getAttribute("data-text")))),n=e.children[1],o=e.children[2];n.innerHTML=converter.makeHtml(t),removeClass(n,"nodisplay"),addClass(o,"nodisplay")},displayTextarea=function(e){var t=decodeURIComponent(escape(atob(e.getAttribute("data-text")))),n=e.children[1],o=e.children[2];addClass(n,"nodisplay"),removeClass(o,"nodisplay"),o.innerHTML=t},populateHistoryHtml=function e(){var t="",n="default"===lastOpenedNote?getHistory():getNoteHistory(),o=n.length;n.map(function(e,n){var a=new Date(Date.parse(e.date)),i=a.toDateString().slice(4)+", "+a.toTimeString().slice(0,8),l=btoa(unescape(encodeURIComponent(e.text)));t+="<div class='item' data-text='"+l+"'>\n                <div class='label flex'>\n                    <div>\n                        <p class='id'>#"+(o-n)+"</p>\n                        <p class='date'>"+i+"</p>\n                    </div>\n                    <div class='noselect flex'>\n                        <div class='button'>\n                            <img class='nodrag' src='/assets/svg/bin.svg'/>\n                        </div>\n                        <div class='button'>\n                            <img class='nodrag' src='/assets/svg/view.svg'/>\n                        </div>\n                    </div>\n                </div>\n                <div class='markdown-body'></div>\n                <textarea class='nodisplay' readonly></textarea>\n            </div>"}),getHtmlElement("section.history .list").innerHTML=t,[].concat(_toConsumableArray(document.querySelectorAll("section.history .item"))).reverse().map(function(t,a){displayMarkdown(t);var i=_slicedToArray(t.children[0].children[1].children,2),l=i[0],s=i[1];l.addEventListener("click",function(){n.splice(o-a-1,1),"default"===lastOpenedNote?localStorage.setItem("history",JSON.stringify(n)):setNoteHistory(n),e()}),s.addEventListener("click",function(){t.children[2].classList.contains("nodisplay")?displayTextarea(t):displayMarkdown(t)})})},getSettings=function(){var e=localStorage.getItem("settings");return null===e?null:JSON.parse(e)},setSettings=function(e,t){var n=getSettings();null===n||5!==Object.keys(n).length?n={saveHistory:!0,cursorLastPosition:!0,enablePowerMode:!0,PowerModeColor:!1,PowerModeShake:!1}:n[e]=t,localStorage.setItem("settings",JSON.stringify(n))},settingsControl=function e(){var t=getSettings(),n=document.querySelectorAll("section.settings .item");[].concat(_toConsumableArray(n)).map(function(n){var o=n.getAttribute("data-setting"),a=t[o];removeClass(n,a?"off":"on"),addClass(n,a?"on":"off"),n.onclick=function(){setSettings(o,!a),e()}}),applySettings()},applySettings=function(){var e=getSettings();saveHistory=e.saveHistory,cursorLastPosition=e.cursorLastPosition,e.enablePowerMode?textarea.addEventListener("input",POWERMODE,!1):textarea.removeEventListener("input",POWERMODE,!1),POWERMODE.colorful=e.PowerModeColor,POWERMODE.shake=e.PowerModeShake},openModal=function(e,t){t&&t(),-1===activeModals.indexOf(e)&&activeModals.push(e),1===activeModals.length?(removeClass(e,"z-index-3"),addClass(e,"z-index-2")):2===activeModals.length&&(removeClass(e,"z-index-2"),addClass(e,"z-index-3")),removeClass(e,"nodisplay"),removeClass(mainSection,"noblur"),addClass(mainSection,"blur"),sectionMainEventListener||(sectionMainEventListener=!0,mainSection.addEventListener("click",function(){return closeModal(activeModals)},!1))},closeModal=function e(t){t.constructor===Array?t.map(function(t){return e(t)}):(-1!==activeModals.indexOf(t)&&activeModals.splice(activeModals.indexOf(t),1),addClass(t,"nodisplay")),0===activeModals.length&&(removeClass(mainSection,"blur"),addClass(mainSection,"noblur"))},dragModal=function(e){var t=getHtmlElement("section."+e),n=0,o=0,a=0,i=0,l=function(e){(e=e||window.event).preventDefault(),n=a-e.clientX,o=i-e.clientY,a=e.clientX,i=e.clientY,t.style.top=t.offsetTop-o+"px",t.style.left=t.offsetLeft-n+"px"},s=function e(){document.removeEventListener("mouseup",e,!1),document.removeEventListener("mousemove",l,!1)};getHtmlElement("section."+e+" .header").addEventListener("mousedown",function(e){(e=e||window.event).preventDefault(),a=e.clientX,i=e.clientY,document.addEventListener("mouseup",s,!1),document.addEventListener("mousemove",l,!1)},!1)},timeDisplay=function(){var e=getHtmlElement("#time");setInterval(function(){var t=new Date,n=(t.getDate()<10?"0"+t.getDate():t.getDate())+"/"+(t.getMonth()+1<10?"0"+(t.getMonth()+1):t.getMonth()+1)+"/"+(t.getFullYear()<10?"0"+t.getFullYear():t.getFullYear())+" - "+(t.getHours()<10?"0"+t.getHours():t.getHours())+":"+(t.getMinutes()<10?"0"+t.getMinutes():t.getMinutes())+":"+(t.getSeconds()<10?"0"+t.getSeconds():t.getSeconds());e.innerHTML="&nbsp;-&nbsp;"+n},1e3)},initiate=function(){setSettings(),settingsControl(),(converter=new showdown.Converter({simplifiedAutoLink:!0,excludeTrailingPunctuationFromURLs:!0,strikethrough:!0,tables:!0,tasklist:!0,ghCodeBlocks:!0,smoothLivePreview:!0,smartIndentationFix:!0,simpleLineBreaks:!0,openLinksInNewWindow:!0,emoji:!0})).setFlavor("github"),populateNotes(),showDashboard(),dragModal("history"),dragModal("settings"),timeDisplay(),setInterval(function(){var e=localStorage.getItem("lastEdited");"default"!==lastOpenedNote&&(e=getNote(lastOpenedNote).lastEdited),getHtmlElement("#lastEdited").innerHTML=null==e?"Last edited: -":"Last edited: "+timeago().format(Date.parse(e))},1e3),getHtmlElement("#edit").addEventListener("click",function(){edit()},!1),getHtmlElement("#save").addEventListener("click",function(){save()},!1),getHtmlElement("#lastEdited").addEventListener("click",function(){openModal(historySection,populateHistoryHtml)},!1),getHtmlElement("#closeHistory").addEventListener("click",function(){closeModal(historySection)},!1),getHtmlElement("#settings").addEventListener("click",function(){openModal(settingsSection,settingsControl)},!1),getHtmlElement("#closeSettings").addEventListener("click",function(){closeModal(settingsSection)},!1),getHtmlElement("#settings-add").addEventListener("click",function(){openModal(notelistSection)},!1),getHtmlElement("#closeNotesAdd").addEventListener("click",function(){closeModal(noteaddSection)},!1),getHtmlElement("#closeNotesEdit").addEventListener("click",function(){closeModal(noteeditSection)},!1),getHtmlElement("#note-submit").addEventListener("click",function(){addNote()},!1),getHtmlElement("#name").addEventListener("click",function(){editNoteMetaData()},!1),getHtmlElement("#settings-home").addEventListener("click",function(){showDashboard()},!1),document.addEventListener("keydown",function(e){(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)?83===e.keyCode?(e.preventDefault(),save()):88===e.keyCode&&textarea.classList.contains("nodisplay")&&(e.preventDefault(),edit()):27===e.keyCode&&activeModals.length>0&&closeModal([].concat(activeModals).pop())},!1)},editNoteMetaData=function(){if(closeModal(notelistSection),getHtmlElement("#notes-edit-header").innerHTML="Edit Note","default"===lastOpenedNote)alert("Default Note cannot be modifed!");else{var e=getNote(lastOpenedNote);if(null===e)return;getHtmlElement("#note-edit-name").value=e.name,openModal(noteeditSection),getHtmlElement("#note-name-submit").addEventListener("click",function(){var t=getHtmlElement("#note-edit-name").value;if(!checkForDuplicate(t,noteeditSection,"#notes-edit-header")){e.name=t;var n=localStorage.getItem("notes");if(null!=n){var o=JSON.parse(n);e.id in o&&(o[e.id]=e),localStorage.setItem("notes",JSON.stringify(o)),switchNote(e)}closeModal(noteeditSection),populateNotes()}}),getHtmlElement("#note-delete").addEventListener("click",function(){e.name=getHtmlElement("#note-edit-name").value;var t=localStorage.getItem("notes");if(null!=t){var n=JSON.parse(t);e.id in n&&(delete n[e.id],localStorage.setItem("notes",JSON.stringify(n)),switchToDefaultNote())}closeModal(noteeditSection),populateNotes()})}},populateNotes=function(){var e="",t=localStorage.getItem("notes");[].concat(_toConsumableArray(document.querySelectorAll("section.notelist .item"))).reverse().map(function(e,t){"note"===e.getAttribute("data-setting")&&e.remove()}),null!==t&&t.length>0&&(t=JSON.parse(t),Object.keys(t).map(function(n,o){var a=t[n].name,i=t[n].id;e+='<div class="item flex" data-setting="note" id='+i+'><div class="main flex"><label>'+a+"</label></div></div>"})),getHtmlElement("section.notelist").innerHTML+=e,[].concat(_toConsumableArray(document.querySelectorAll("section.notelist .item"))).reverse().map(function(e,t){"note"===e.getAttribute("data-setting")?e.addEventListener("click",function(){var t=getNote(e.id);null!==t?switchNote(t):alert("Error Fetching Note with name: "+e.innerHTML)}):"notelist-default"==e.id&&e.addEventListener("click",function(){switchToDefaultNote()})}),getHtmlElement("#notelist-add-note").addEventListener("click",function(){openModal(noteaddSection,hideNoteAddSection)},!1)},hideNoteAddSection=function(){closeModal(notelistSection),getHtmlElement("#notes-add-header").innerHTML="Add Note",getHtmlElement("#note-add-name").value=""},switchToDefaultNote=function(){var e={id:"default",name:"Default"};e.rawText=localStorage.getItem("rawText"),switchNote(e)},switchNote=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];lastOpenedNote=e.id,textarea.value=e.rawText,getHtmlElement("#name").innerHTML=""+e.name,t?edit():show(),hideNoteAddSection(),localStorage.setItem("lastOpened",lastOpenedNote),removeClass(mainSection,"nodisplay"),addClass(dashboardSection,"nodisplay")},lastOpenedNote="default",addNote=function(){var e=getHtmlElement("#note-add-name").value,t=localStorage.getItem("notes");if(t=null===t?{}:JSON.parse(t),null!==e&&e.length>0){if(checkForDuplicate(e,noteaddSection,"#notes-add-header"))return;var n={};n.name=e,n.id="note_id_"+(new Date).getTime(),n.rawText="Click to start editing!",n.history=[],n.lastEdited=new Date,t[n.id]=n,localStorage.setItem("notes",JSON.stringify(t)),closeModal(noteaddSection),switchNote(n,!0),populateNotes()}},checkForDuplicate=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=localStorage.getItem("notes");if(null!==o&&o.length>0){o=JSON.parse(o);for(var a=0;a<Object.keys(o).length;a+=1){var i=o[Object.keys(o)[a]].name;if(0==e.toLowerCase().localeCompare(i.toLowerCase()))return""!==n&&(getHtmlElement(n).innerHTML="<span style='color:red'>Duplicate Name!!</span>"),null!==t&&localShake(t,10),!0}}return!1},localShake=function(e,t){var n=t+2*Math.random(),o=n*(Math.random()>.5?-1:1),a=n*(Math.random()>.5?-1:1);e.style.marginLeft=o+"px",e.stylemarginTop=a+"px",setTimeout(function(){e.style.marginLeft="",e.style.marginTop=""},75)},showDashboard=function(){removeClass(dashboardSection,"nodisplay"),addClass(mainSection,"nodisplay"),getHtmlElement("#name").innerHTML="Dashboard";var e="markdown-body markdown-preview",t=localStorage.getItem("notes");if(null!=t&&t.length>0){for(;dashboardSection.firstChild;)dashboardSection.removeChild(dashboardSection.firstChild);var n=document.createElement("div");n.className=e,n.innerHTML=converter.makeHtml(rawText),dashboardSection.appendChild(n),t=JSON.parse(t),Object.keys(t).map(function(n,o){var a=document.createElement("div");a.className=e,a.innerHTML=converter.makeHtml(t[n].rawText),dashboardSection.appendChild(a)})}else switchToDefaultNote()};initiate();